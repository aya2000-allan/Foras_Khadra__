@model IEnumerable<Foras_Khadra.Models.TeamMember>
@using Foras_Khadra.Helpers
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@{
    Layout = "_Layout";
    var culture = System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
    var dir = culture == "ar" ? "rtl" : "ltr";
    ViewData["Title"] = Localizer["AboutUsTitle"];
}

<link href="~/css/Home.css" rel="stylesheet" />

<!-- Swiper CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<style>
/* ===== Layout: column for admin + slider next to it ===== */
.teams-section, .team-block {
  width: 100%;
}

.team-grid{
  display: flex;
  gap: 24px;
  align-items: stretch;
  width: 100%;
}

.group-card{
  flex: 0 0 320px;   
  max-width: 360px;
}

.team-swiper{
  flex: 1 1 auto;
  width: 100%;
  min-width: 0;     
  padding: 10px 0 36px;
}

.team-swiper .swiper-slide{
  height: auto;
}

/* أزرار السلايدر */
.team-swiper .swiper-button-next,
.team-swiper .swiper-button-prev{
  color: var(--green);
}

/* Pagination */
.team-swiper .swiper-pagination-bullet{ opacity:.35; }
.team-swiper .swiper-pagination-bullet-active{ opacity:1; }

/* على الشاشات الصغيرة: خليه عمودي */
@@media (max-width: 900px){
  .team-grid{
    flex-direction: column;
  }
  .group-card{
    max-width: 100%;
    flex: none;
  }
}
/* الشبكة الأساسية: كولوم + سلايدر */
.team-grid{
  display: flex;
  gap: 24px;
  align-items: stretch;   /* خليهم نفس الارتفاع */
  width: 100%;
}

.group-card{
  flex: 0 0 340px;        /* عدّل العرض حسب ذوقك */
  max-width: 380px;
  display: flex;
  flex-direction: column;
  justify-content: space-between; 
}

/* السلايدر ياخذ باقي المساحة */
.team-swiper{
  flex: 1 1 auto;
  width: 100%;
  min-width: 0;           
  padding: 10px 48px;     
  align-items: center;    

/* خلّي الـ wrapper يتوسّط */
.team-swiper .swiper-wrapper{
  align-items: center;    /* ✅ الكروت بالنص عموديًا */
}

/* السلايد نفسه */
.team-swiper .swiper-slide{
  height: auto;
  display: flex;
  justify-content: center;
}

/* الأسهم بالنص عموديًا */
.team-swiper .swiper-button-next,
.team-swiper .swiper-button-prev{
  top: 50%;
  transform: translateY(-50%);
  color: var(--green);
}

/* Pagination تحت السلايدر */
.team-swiper .swiper-pagination{
  bottom: 0px !important;
}

/* على الشاشات الصغيرة: خليهم تحت بعض */
@@media (max-width: 900px){
  .team-grid{
    flex-direction: column;
  }
  .group-card{
    max-width: 100%;
    flex: none;
  }
  .team-swiper{
    padding: 10px 0 36px;
  }
}


</style>

<!-- ===== HERO ===== -->
<section class="about-hero">
  <div class="about-overlay">
    <h1>@Localizer["AboutUsTitle"]</h1>
    <p>@Localizer["AboutUsDesc"]</p>
  </div>
</section>

<!-- ===== TEAMS ===== -->
<section class="teams-section">

@foreach (var group in Model.GroupBy(m => m.Department))
{
  <div class="team-block">
    <div class="team-grid">

      <!-- الكولوم: الهيئة الإدارية / القسم -->
      <div class="group-card">
        <h2 class="team-title">@DepartmentTranslator.TranslateName(group.Key, culture)</h2>

        <div class="group-bio">
          @{
            var desc = DepartmentTranslator.TranslateDesc(group.Key, culture);
            var firstSentence = desc.Contains(".") ? desc.Split('.')[0] + "." : desc;
            var rest = desc.Contains(".") ? desc.Substring(firstSentence.Length) : "";
          }
          <p><strong>@firstSentence</strong>@rest</p>
        </div>
      </div>

      <!-- السلايدر جنبها -->
      <div class="swiper team-swiper" data-dir="@dir">
        <div class="swiper-wrapper">

        @foreach (var member in group.OrderBy(m => m.CreatedAt))
        {
          <div class="swiper-slide">
            <div class="team-card">

              @if (!string.IsNullOrEmpty(member.ImagePath))
              {
                <img src="@member.ImagePath" alt="@member.NameAr" class="member-img" />
              }

              <div class="team-card-footer" onclick="toggleBio(@member.Id)">
                <div class="footer-title">
                  <img src="~/images/team_leaf.svg" alt="leaf" class="footer-leaf" />
                  <h4>
                    @(culture == "ar" ? member.NameAr :
                      culture == "fr" ? member.NameFr :
                      member.NameEn)
                  </h4>
                </div>

                <span class="role">
                  @MembershipTranslator.Translate(member.Membership, member.Gender, culture)
                </span>
              </div>

              <div id="bio-@member.Id" class="bio" style="background-image:url(@member.ImagePath)">
                <div class="bio-overlay">
                  @Html.Raw(
                    culture == "ar" ? member.BioAr :
                    culture == "fr" ? member.BioFr :
                    member.BioEn
                  )
                </div>
              </div>

            </div>
          </div>
        }

        </div>

        <!-- Controls -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
      </div>

    </div>
  </div>
}

</section>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
function toggleBio(id){
  const el = document.getElementById("bio-" + id);
  if(el) el.classList.toggle("open");
}

document.addEventListener("DOMContentLoaded", function(){
  document.querySelectorAll(".team-swiper").forEach(function(el){
    const dir = el.getAttribute("data-dir") || "ltr";
    el.setAttribute("dir", dir);

    new Swiper(el, {
      spaceBetween: 16,
      grabCursor: true,
      loop: false,

      slidesPerView: 1.1,

      pagination: {
        el: el.querySelector(".swiper-pagination"),
        clickable: true
      },
      navigation: {
        nextEl: el.querySelector(".swiper-button-next"),
        prevEl: el.querySelector(".swiper-button-prev")
      },

          breakpoints: {
      480:  { slidesPerView: 1 },
      640:  { slidesPerView: 2 },
      900:  { slidesPerView: 3 },
      1200: { slidesPerView: 3 } 
    }
    });
  });
});
</script>
