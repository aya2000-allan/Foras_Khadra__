@model Foras_Khadra.Models.HomeArticlesViewModel
@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    bool isLoggedIn = SignInManager.IsSignedIn(User);
    bool isAdmin = false;

    if (isLoggedIn)
    {
        var appUser = await UserManager.GetUserAsync(User);
        if (appUser != null)
        {
            isAdmin = await UserManager.IsInRoleAsync(appUser, "Admin");
        }
    }
}

<section>
    <h2>آخر المقالات</h2>

    <div class="latest-articles">
        @foreach (var article in Model.LatestArticles)
        {
            <div class="article-card featured">
                <img src="@article.ImagePath" alt="@article.Title" />
                <h3>@article.Title</h3>
                <p>@article.Author</p>

                @if (isLoggedIn || isAdmin)
                {
                    <!-- Admin أو مستخدم مسجل -->
                    <a asp-controller="Articles"
                       asp-action="Details"
                       asp-route-id="@article.Id">
                        اقرأ المزيد
                    </a>
                }
                else
                {
                    <!-- غير مسجل -->
                    <a href="javascript:void(0);" onclick="swalNotLoggedIn();">
                        اقرأ المزيد
                    </a>
                }
            </div>
        }
    </div>
</section>

<hr />

<section>
    <h2>باقي المقالات</h2>

    @foreach (var article in Model.OtherArticles)
    {
        <div class="article-row">
            <img src="@article.ImagePath" width="200" />
            <div>
                <h4>@article.Title</h4>
                <p>@article.Author</p>

                @if (isLoggedIn || isAdmin)
                {
                    <a asp-controller="Articles"
                       asp-action="Details"
                       asp-route-id="@article.Id">
                        اقرأ المزيد
                    </a>
                }
                else
                {
                    <a href="javascript:void(0);" onclick="swalNotLoggedIn();">
                        اقرأ المزيد
                    </a>
                }
            </div>
        </div>
        <hr />
    }
</section>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function swalNotLoggedIn() {
            Swal.fire({
                icon: 'warning',
                title: 'غير مسموح بالقراءة',
                html: 'لا يمكنك قراءة المقالة قبل إنشاء حساب على الموقع أو تسجيل الدخول إذا كان لديك حساب.',
                confirmButtonText: 'حسنًا'
            });
        }
    </script>
}