@using Microsoft.Extensions.Options;
@using System.Globalization;
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Title"];
    var culture = System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
    var dir = culture == "ar" ? "rtl" : "ltr";

}

<!-- External styles and icon library -->
<link href="/css/Home.css" rel="stylesheet" />
<script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body{
  background-color: #F6FBF7;
  }
/* ==== Latest Articles Cards (Swiper) ==== */
.latest-articles .article-card{
  @* background:#fff; *@
  border-radius:18px;
  overflow:hidden;
  @* box-shadow: 0 10px 25px rgba(0,0,0,.08); *@
  border:1px solid rgba(0,0,0,.04);
  display:flex;
  flex-direction:column;
  width: 100%;
  margin-bottom: 15px;
  }

.latest-articles .article-img{
  width:100%;
  height: 230px;         
  overflow:hidden;
  border-radius:18px 18px 0 0;
  background:#fff;
}

.latest-articles .article-img img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* body */
.latest-articles .article-body{
  padding:14px 16px 16px;
  display:flex;
  flex-direction:column;
  gap:8px;
  background-color: #fff;
}

/* التاريخ (يمين فوق) */
.latest-articles .article-date{
  align-self:flex-end;      /* يمين */
  font-size:12px;
  color:#f99d27;
  font-weight:700;
  display:inline-block;
}

/* العنوان */
.latest-articles .article-title{
  font-size:16px;
  font-weight:900;
  color:#1f1f1f;
  line-height:1.5;

  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* الوصف */
.latest-articles .article-desc{
  margin:0;
  font-size:13px;
  color:#fff;
  line-height:1.75;

  display:-webkit-box;
  -webkit-line-clamp:3;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

.latest-articles .read-more{
  margin-top:auto;
  align-self:flex-end;   
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-size:13px;
  font-weight:800;
  color: var(--green);
  text-decoration:none;
}

.latest-articles .read-more iconify-icon{
  font-size:18px;
  color: var(--green);
}

.latest-articles .swiper-slide{
  height:auto;
  display:flex;
  justify-content:center;
}

.latest-articles .swiper{
  padding-bottom: 6px;

}
.latest-articles .article-meta{
  display:flex;
  align-items:center;
  justify-content:space-between;
  width:100%;
  direction: rtl;
  font-size:12px;
  font-weight:700;
    flex-direction: row-reverse; 

}

.latest-articles .meta-author{
  color:#f99d27; 
}

.latest-articles .meta-date{
  color:#f99d27; 
}
.custom-arrow{
  position: relative;     
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: #E9F7ED;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.custom-arrow::after{
  font-size: 16px;
  font-weight: bold;
  color: var(--green);      
}

.swiper-button-prev,
.swiper-button-next{
  top: auto;
  left: auto;
  right: auto;
  bottom: auto;
}

.view-all-btn iconify-icon {
    font-size: 18px;
}



.view-all-btn {
    transition: all .2s ease;
}

.view-all-btn:hover {
    text-decoration: underline;
    opacity: .8;
}

    .swal-title-rtl {
        direction: rtl;
        text-align: center;
    }

    .swal-title-ltr {
        direction: ltr;
        text-align: center;
    }

    .swal-text-rtl {
        direction: rtl;
        text-align: center;
    }

    .swal-text-ltr {
        direction: ltr;
        text-align: center;
    }

    .swal-title, .swal-text {
        text-align: center; /* دائماً وسط */
    }
  .swal2-popup.foras-swal {
    border-radius: 18px !important;
    padding: 18px 22px 20px !important;
    width: 520px !important;
    max-width: 92vw !important;
  }

  .foras-login-card {
    text-align: center;
  }

  .foras-login-card .foras-img {
    width: 155px;
    max-width: 60%;
    margin: 6px auto 10px;
    display: block;
  }

  .foras-login-card h3 {
    margin: 10px 0 6px;
    font-weight: 900;
    color: #1f1f1f;
    font-size: 28px;
  }

  .foras-login-card p {
    margin: 0 0 16px;
    color: #25652C;
    font-weight: 600;
    font-size: 18px;
    line-height: 1.6;
  }

  .foras-actions {
    display: flex;
    gap: 14px;
    justify-content: center;
    margin-top: 6px;
  }

  .foras-btn {
    border-radius: 12px;
    padding: 12px 22px;
    font-weight: 900;
    font-size: 16px;
    cursor: pointer;
    border: 2px solid #F99D27;
    background: #fff;
    color: #F99D27;
    min-width: 150px;
  }

  .foras-btn-primary {
    background: #F99D27;
    color: #fff;
  }

  /* RTL / LTR tweaks */
  .foras-login-card.rtl { direction: rtl; }
  .foras-login-card.ltr { direction: ltr; }
.home-hero-bg{
  background:#F6FBF7;
}



</style>
<!-- Main Container -->
<div class="container-fluid py-5 rtl home-hero-bg" style="position:relative;margin:7% 0;">

    <!-- Floating Circles -->
    <div class="floating-shapes" id="floatingShapes"></div>

    <div class="row align-items-start  justify-content-between m-0">

        <!-- Right: Text and search -->
        <div class="col-lg-5 custom-col-full" style="padding:27px 0 ;">
            <h2 class=" mb-3 main-header">
                منصة فرص خضراء
            </h2>
            <h4 class="mb-4" style="color:var(--textColor); font-size:40px;font-weight:500; font-stretch: expanded;">من وإلى شباب عربي</h4>
            <p class="mb-4 responsive-text" style="font-size:20px;font-weight:350; text-align:justify;max-width:443px">
                هذا النص هو مثال لنص يمكن أن يستبدل في نفس المساحة. لقد تم توليد هذا النص من مولد النص العربي، حيث يمكنك أن تولد مثل هذا النص أو العديد من النصوص الأخرى إضافة إلى زيادة عدد الحروف التى يولدها التطبيق.
            </p>
           
        </div>

        <!-- Left: Images and colored blocks -->
        <div class="d-flex  flex-row-reverse  justify-content-center align-items-start  col-lg-7  mb-4 mb-lg-0 position-relative custom-col-full" style="  background:var(--bg); ">
           
            <!--Center: leaf icon -->
            <div class="position-absolute leaf d-flex justify-content-center align-items-center rounded-circle bg-orange text-white ">
                <img src="/images/leaf.svg" alt="Alternate Text" />
            </div>

            <div class="d-flex  flex-column  justify-content-center w-50 ">
                <div class=" d-flex transparent flex-row-reverse  justify-content-center align-items-end ">

                    <div class="outer-border" style="border-top:74px solid var(--bg);         background: var(--bg);
">
                        <div class="custom-bg-green rounded-20 box-border-fix " style="width:103px; height: 183px;  "></div>
                    </div>
                    <div     id="heroBg1" class="bg-transparent rounded-20 overflow-hidden box-border-fix  outer-border" style="width: 90%; height: 247px; position:relative;  background-image:url(/images/cover.svg);    background-position: 21% 0%;">
                    </div>
                </div>

                <div class="d-flex transparent flex-row-reverse  justify-content-center alig-items-end   ">

                    <div class="custom-bg-orange rounded-20 d-flex align-items-center justify-content-center box-border-fix outer-border  " style="width: 57%; height: 240px; position:relative;overflow:hidden ">
                        <img src="/images/plane.svg" alt="Alternate Text" style="width:100%;" />
                    </div>

                    <div     id="heroBg2" class="bg-transparent rounded-20 overflow-hidden  box-border-fix outer-border" style="width: 167px; height: 240px; position:relative; background-image:url(/images/cover.svg);    background-position: 33% 80%;">
                    </div>
                </div>
            </div>
            <div class="d-flex  flex-column  justify-content-center align-items-end  w-50 ">
                <div     id="heroBg3" class="bg-transparent rounded-20 overflow-hidden  box-border-fix outer-border" style="width: 95%; height: 396px;  background-image:url(/images/cover.svg);    background-position: 71% 0%;">
                </div>
                <div style=" background:var(--bg) ;">
                    <div class="outer-border w-100" style="float: left;">
                        <div class="rounded-20 box-border-fix" style="width: 70%; min-width:283px;height: 89px; background: #C6ECC9; ">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<section class="latest-articles rtl py-5" style="background:#F6FBF7;">
    <div class="container">

        <!-- العنوان + زر عرض الكل -->
        <div class="d-flex justify-content-between align-items-center mb-4">

    <!-- يمين: الأيقونة + العنوان -->
    <div class="d-flex align-items-center gap-2">
        <span class="section-icon" aria-hidden="true">
            <!-- SVG -->
           <svg width="54" height="54" viewBox="0 0 54 54" fill="none" xmlns="http://www.w3.org/2000/svg"> <circle cx="27" cy="27" r="27" fill="#F99D27"/> <path d="M21.9104 25.2275C22.0086 25.1232 22.1264 25.0392 22.257 24.9804C22.3877 24.9216 22.5287 24.8891 22.6719 24.8848C22.8151 24.8805 22.9578 24.9045 23.0917 24.9553C23.2257 25.0062 23.3483 25.0829 23.4526 25.1811C28.4729 29.9102 33.5101 32.7875 39.4379 34.2541C40.2376 32.0723 40.3085 29.6709 39.6179 27.3282C38.7015 24.2198 36.5674 21.5116 33.4481 19.4968C30.6635 17.6982 27.8804 17.2298 25.1879 16.777C21.791 16.2057 18.5824 15.6657 15.5204 12.4236C15.1794 12.065 14.7151 11.9211 14.2713 12.0377C13.764 12.1741 13.4238 12.575 13.2608 13.2377C12.879 14.7889 13.1244 19.1361 14.1983 23.7254C15.9226 31.0986 18.6744 34.8295 20.6797 36.6616C23.2706 39.0268 26.6538 40.3366 30.0158 40.3366C30.6495 40.3376 31.2824 40.2911 31.9092 40.1975C34.7531 39.7666 37.1204 38.3382 38.4547 36.26C32.3531 34.6727 27.1406 31.6543 21.9547 26.7718C21.8502 26.6734 21.7661 26.5554 21.7073 26.4245C21.6485 26.2935 21.6162 26.1523 21.612 26.0088C21.6079 25.8654 21.6322 25.7225 21.6833 25.5884C21.7345 25.4544 21.8117 25.3317 21.9104 25.2275ZM42.7795 34.9223C41.632 34.7457 40.5206 34.5241 39.4385 34.2561C39.2161 34.8635 38.9393 35.4495 38.6115 36.007C38.5617 36.0923 38.5092 36.1768 38.4554 36.26C39.7714 36.6007 41.1041 36.8738 42.4481 37.0782C42.5911 37.1033 42.7377 37.0996 42.8793 37.0674C43.0208 37.0351 43.1546 36.9749 43.2726 36.8903C43.3906 36.8057 43.4905 36.6984 43.5665 36.5747C43.6425 36.451 43.693 36.3133 43.7151 36.1698C43.7372 36.0263 43.7305 35.8798 43.6952 35.7389C43.66 35.5981 43.597 35.4657 43.5099 35.3495C43.4228 35.2333 43.3134 35.1357 43.1881 35.0623C43.0628 34.9889 42.9241 34.9413 42.7801 34.9223H42.7795Z" fill="white"/> </svg>
        </span>

                <h2 class="section-title m-0" style="color:#25652C; font-weight: bold;">@Localizer["LatestArticles"]</h2>
    </div>

    <!-- يسار: عرض الكل -->
  <a href="~/Home/Articles"
   class="view-all-btn"
   style="color:#25652C; font-weight:bold; font-size:18px; text-decoration:none; display:flex; align-items:center; gap:6px;">

    <iconify-icon icon="mdi:clock-outline"
                  style="color:#25652C; font-size:18px;">
    </iconify-icon>

                @Localizer["ViewAll"]
</a>


</div>


        <!-- السلايدر (الكروت فقط) -->

        <div class="swiper articlesSwiper mb-4">
            <div class="swiper-wrapper">

                @foreach (var article in Model.LatestArticles)
                {
                 
   
        var title = culture == "ar" ? article.TitleAr
                  : culture == "en" ? article.TitleEn
                  : article.TitleFr;

        var content = culture == "ar" ? article.ContentAr
                    : culture == "en" ? article.ContentEn
                    : article.ContentFr;

        var author = culture == "ar"
                    ? "فرص خضراء"
                    : "Foras Khadra";

    

                    <div class="swiper-slide">
                        <div class="article-card">

                            <div class="article-img">
                                <img src="@(!string.IsNullOrEmpty(article.ImagePath)
                                                                 ? article.ImagePath
                                                                 : "/images/default-article.jpg")"
                                                                                                                                      alt="@title" />
                                                                                        </div>

                         <div class="article-body">

    <div class="article-meta">
                                    <span class="meta-author">@author</span>
        <span class="meta-date">@article.PublishDate.ToString("dd MMM yyyy")</span>
    </div>

    <h5 class="article-title">
                                    @title
    </h5>

    <p class="article-desc">
                                    @(content.Length > 120
                                                                    ? content.Substring(0, 120) + "..."
                                                                    : content)
    </p>

                                <a href="javascript:void(0);"
                                   class="read-more btn-read-more"
                                   data-article-id="@article.Id">
                                    @Localizer["ReadMore"]
                                    <iconify-icon icon="mdi:arrow-left"></iconify-icon>
                                </a>


</div>


                        </div>
                    </div>
                                }

            </div>
        </div>
        <!-- الأسهم تحت الكروت -->
        <div class="d-flex justify-content-center gap-3">
                        <div class="swiper-button-next custom-arrow"></div>

            <div class="swiper-button-prev custom-arrow"></div>
            @* <div class="swiper-button-next custom-arrow"></div> *@
        </div>

    </div>
</section>


<script>
    const container = document.getElementById("floatingShapes");
    const totalCount = 8;
    let circleCount = 5;
    let starCount = 3;

    const containerWidth = container.clientWidth;
    const spacing = containerWidth / totalCount;
    let fromTop = true;

    const colors = ['var(--orange)', 'var(--green)'];

    for (let i = 0; i < totalCount; i++) {
      let shape;
      let isCircle;

      // Decide whether to create a circle or star
      if (circleCount > 0 && starCount > 0) {
        isCircle = Math.random() > 0.5;
      } else if (circleCount > 0) {
        isCircle = true;
      } else {
        isCircle = false;
      }

      if (isCircle) {
        shape = document.createElement("span");
        shape.classList.add("shape", "circle");

        const size = 27 + Math.random() * (42 - 27);
        shape.style.width = `${size}px`;
        shape.style.height = `${size}px`;
        shape.style.opacity = `${0.5 + Math.random() * 0.2}`; // 0.5 - 0.7
        shape.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

        circleCount--;
      } else {
        shape = document.createElement("iconify-icon");
        shape.setAttribute("icon", "oui:sparkle-filled");
        shape.classList.add("shape", "star");

        const size = 32;
        shape.width = `${size}px`;
        shape.height = `${size}px`;
        shape.style.opacity = Math.random() > 0.5 ? "0.5" : "1";
        shape.style.color = colors[Math.floor(Math.random() * colors.length)];

        starCount--;
      }

      // Common styles
      shape.style.position = "absolute";
      shape.style.left = `${i * spacing}px`;

      if (i === totalCount - 1 && fromTop) {
        i = -1;
        fromTop = false;
        circleCount = 5;
        starCount = 3;
        continue;
      }

      if (fromTop) {
        shape.style.top = `${Math.random() *40 }px`;
      } else {
        shape.style.bottom = `${Math.random() * 40}px`;
      }

      shape.style.animationDelay = `${Math.random() * 7}s`;

      container.appendChild(shape);
    }
</script>
<script>
    new Swiper(".articlesSwiper", {
        slidesPerView: 9,
        spaceBetween: 16,
        loop: true,
        autoplay: {
            delay: 3500,
            disableOnInteraction: false,
        },
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        breakpoints: {
            0: { slidesPerView: 1 },
            768: { slidesPerView: 2 },
            1200: { slidesPerView: 3 }
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  const loginPopupImg = '@Url.Content("~/images/login-required.svg")'; // <-- غيّري اسم الملف

  document.querySelectorAll(".btn-read-more").forEach(btn => {
    btn.addEventListener("click", function () {

      const isAuthenticated = @User.Identity.IsAuthenticated.ToString().ToLower();
      const culture = '@culture'; // ar / en / fr
      const isRtl = (culture === "ar");

      if (!isAuthenticated) {
        const tMap = {
          ar: {
            title: "تسجيل الدخول مطلوب!",
            text: "أنشئ حساب لتتمكن من التقديم، وإذا كان لديك حساب بالفعل\nسجل الدخول الآن",
            login: "تسجيل الدخول",
            register: "إنشاء حساب"
          },
          en: {
            title: "Login required!",
            text: "Create an account to apply. If you already have an account,\nlog in now.",
            login: "Login",
            register: "Create account"
          },
          fr: {
            title: "Connexion requise !",
            text: "Créez un compte pour postuler. Si vous avez déjà un compte,\nconnectez-vous.",
            login: "Se connecter",
            register: "Créer un compte"
          }
        };

        const t = tMap[culture] || tMap.en;

        Swal.fire({
          customClass: { popup: 'foras-swal' },
          showConfirmButton: false,
          showCloseButton: true,
          focusConfirm: false,
          html: `
            <div class="foras-login-card ${isRtl ? "rtl" : "ltr"}">
              <img class="foras-img" src="${loginPopupImg}" alt="login">
              <h3>${t.title}</h3>
              <p>${t.text.replace(/\n/g, "<br/>")}</p>

              <div class="foras-actions">
                <button id="forasLoginBtn" class="foras-btn foras-btn-primary">${t.login}</button>
                <button id="forasRegisterBtn" class="foras-btn">${t.register}</button>
              </div>
            </div>
          `
        });

        // attach events بعد ما ينرسم
        setTimeout(() => {
          document.getElementById("forasLoginBtn")?.addEventListener("click", () => {
            window.location.href = "/Account/Login";
          });

          document.getElementById("forasRegisterBtn")?.addEventListener("click", () => {
            window.location.href = "/Account/RegisterUser";
          });
        }, 0);

      } else {
        const articleId = btn.dataset.articleId;
        window.location.href = '/Articles/Details/' + articleId;
      }
    });
  });
</script>

<script>
  // Hero Background Image Slider for the three transparent divs
function initHeroBgSlider() {
    // Array of background images to cycle through
    const bgImages = [
        'url(/images/cover.svg)',
        'url(/images/img1.svg)',  // Add your second image here
        'url(/images/img3.svg)',  // Add your third image here
        'url(/images/img4.svg)'   // Add more as needed
    ];
    
    const bgElements = [
        document.getElementById('heroBg1'),
        document.getElementById('heroBg2'),
        document.getElementById('heroBg3')
    ];
    
    // Check if all elements exist
    if (!bgElements[0] || !bgElements[1] || !bgElements[2]) return;
    
    let currentIndex = 0;
    
    function changeBackground() {
        // Move to next image
        currentIndex = (currentIndex + 1) % bgImages.length;
        const newBgImage = bgImages[currentIndex];
        
        // Update all three elements simultaneously
        bgElements.forEach(element => {
            if (element) {
                element.style.backgroundImage = newBgImage;
            }
        });
    }
    
    // Change background every 5 seconds
    setInterval(changeBackground, 5000);
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', initHeroBgSlider);
</script>
