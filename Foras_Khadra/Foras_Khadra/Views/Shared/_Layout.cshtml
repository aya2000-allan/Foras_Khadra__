

<!DOCTYPE html>
@{
    var culture = System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
    var dir = culture == "ar" ? "rtl" : "ltr";
}
<html lang="@culture" dir="@dir">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Foras_Khadra</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/layout_style.css">
</head>


<body>

    <style>
        .language-dropdown {
            position: relative;
            display: inline-block;
        }

        .lang-toggle {
            background: none;
            border: none;
            cursor: pointer;
        }

        .lang-list {
            display: none; /* مخفي افتراضي */
            position: absolute;
            top: 100%;
            left: 0;
            list-style: none;
            padding: 0;
            margin: 0;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 100;
        }

            .lang-list li {
                padding: 5px 10px;
            }

                .lang-list li a {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    text-decoration: none;
                    color: black;
                }

                    .lang-list li a:hover {
                        background-color: #f0f0f0;
                    }

    </style>


    @using Microsoft.AspNetCore.Identity
    @inject UserManager<ApplicationUser> UserManager
    @inject SignInManager<ApplicationUser> SignInManager
    @using Microsoft.AspNetCore.Localization;
    @using Microsoft.Extensions.Options;
    @using System.Globalization;
    @using Microsoft.AspNetCore.Mvc.Localization
    @inject IViewLocalizer Localizer


    @{
        var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();
        var currentController = ViewContext.RouteData.Values["Controller"]?.ToString();

        bool hideNavAndFooter = false;

        var userIsAuthenticated = User.Identity.IsAuthenticated;
        var isAdmin = false;
        var isOrganization = false;

        if (userIsAuthenticated)
        {
            var userEmail = User.Identity.Name;
            var appUser = await UserManager.FindByEmailAsync(userEmail);
            if (appUser != null)
            {
                isAdmin = await UserManager.IsInRoleAsync(appUser, "Admin");
                isOrganization = await UserManager.IsInRoleAsync(appUser, "Organization");
            }
        }

        if (currentController == "Admin" && currentAction == "ReelsRequestsDashboard")
        {
            hideNavAndFooter = true;
        }
        else
        {
            // باقي الشروط القديمة للـ Admin
            if (isAdmin)
            {
                // الشروط القديمة بدون أي تغيير
                if ((currentController == "Opportunity" && (currentAction == "Index" || currentAction == "Create" || currentAction == "Edit"))
                || (currentController == "AdminController")) // مثال: أي Controller إداري آخر
                {
                    hideNavAndFooter = true;
                }
                else
                {
                    hideNavAndFooter = false;
                }
            }
        }

        // إذا المستخدم Admin والصفحة من Articles، نخفي Navbar و Footer
        if (isAdmin && currentController == "Articles")
        {
            hideNavAndFooter = true;
        }
   

    }
    
    

    @if (!hideNavAndFooter)
    {
        <!-- Navbar -->
        <header>
            <div class="top-banner">
                <div class="logo">
                    <img src="~/Images/logo.png" alt="شعار المنصة" />
                </div>

                <div class="nav-content">
                    <div class="menu-items">
                        <a asp-controller="Home" asp-action="Index">@Localizer["Home"]</a>
                        <a asp-controller="Home" asp-action="Articles">@Localizer["Articles"]</a>
                        <a asp-controller="Home" asp-action="News">@Localizer["News"]</a>

                        <div class="custom-dropdown">
                            <button class="dropdown-button" onclick="toggleOpportunities()">@Localizer["Opportunities"]</button>
                            <div class="dropdown-list" id="opportunitiesDropdown">
                                <a asp-controller="Home" asp-action="AllOpportunities"> @Localizer["AllOpportunities"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Competitions">@Localizer["Competitions"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Conferences">@Localizer["Conferences"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Volunteering">@Localizer["VolunteeringOpportunities"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Jobs">@Localizer["Jobs"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Scholarships">@Localizer["Scholarships"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Fellowships">@Localizer["Fellowships"]</a>
                                <a asp-controller="Home" asp-action="AllOpportunities" asp-route-type="Internships">@Localizer["Internships"]</a>
                            </div>
                        </div>

                        <a asp-controller="Home" asp-action="AboutUs">@Localizer["AboutUs"]</a>
                        <a asp-controller="Contact" asp-action="Index">@Localizer["ContactUs"]</a>
                    </div>

                    <div class="auth-section d-flex gap-2 align-items-center">
                        @if (!userIsAuthenticated)
                        {
                            <div class="custom-dropdown">
                                <button onclick="toggleLoginMenu()">@Localizer["Login"]</button>
                                <div class="dropdown-list" id="loginMenu">
                                    <a asp-controller="Account" asp-action="Login">@Localizer["Individual"]</a>
                                    <a asp-controller="Organization" asp-action="Login">@Localizer["Organization"]</a>
                                </div>
                            </div>

                            <div class="custom-dropdown">
                                <button onclick="toggleRegisterMenu()">@Localizer["Register"]</button>
                                <div class="dropdown-list" id="registerMenu">
                                    <a asp-controller="Account" asp-action="RegisterUser">@Localizer["Individual"]</a>
                                    <a asp-controller="Organization" asp-action="Register">@Localizer["Organization"]</a>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="custom-dropdown">
                                <button onclick="toggleUserOrgMenu()">
                                    @if (isOrganization)
                                    {
                                        <iconify-icon icon="mdi:office-building" width="30" height="30"></iconify-icon>
                                    }
                                    else
                                    {
                                        <iconify-icon icon="mdi:account" width="30" height="30"></iconify-icon>
                                    }
                                </button>
                                <div class="dropdown-list" id="userOrgMenu">
                                    @if (isOrganization)
                                    {
                                        <a asp-controller="Opportunity" asp-action="OrgOpportunities">@Localizer["AddOpportunity"] </a>
                                        <a asp-controller="Organization" asp-action="ProfileSetting">@Localizer["AccountSettings"]</a>
                                        <form asp-controller="Organization" asp-action="Logout" method="post">
                                            @Html.AntiForgeryToken()
                                            <button type="submit">@Localizer["Logout"]</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <a asp-controller="Account" asp-action="ProfileSettings">@Localizer["AccountSettings"]</a>
                                        <form asp-controller="Account" asp-action="Logout" method="post">
                                            @Html.AntiForgeryToken()
                                            <button type="submit"> @Localizer["Logout"]</button>
                                        </form>
                                    }
                                </div>
                            </div>
                        }



                        <div class="language-dropdown">
                            <button class="lang-toggle">اللغات</button>

                            <ul class="lang-list">
                                <li class="lang-option">
                                    <a asp-controller="Language"
                                       asp-action="Change"
                                       asp-route-culture="ar"
                                       asp-route-returnUrl="@Context.Request.Path">
                                        <img src="~/Images/sa.png" alt="Arabic">
                                        <span>@Localizer["Arabic"]</span>
                                    </a>
                                </li>

                                <li class="lang-option">
                                    <a asp-controller="Language"
                                       asp-action="Change"
                                       asp-route-culture="en"
                                       asp-route-returnUrl="@Context.Request.Path">
                                        <img src="~/Images/us.png" alt="English">
                                        <span>@Localizer["English"]</span>
                                    </a>
                                </li>

                                <li class="lang-option">
                                    <a asp-controller="Language"
                                       asp-action="Change"
                                       asp-route-culture="fr"
                                       asp-route-returnUrl="@Context.Request.Path">
                                        <img src="~/Images/fr.png" alt="French">
                                        <span>@Localizer["French"]</span>
                                    </a>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
        </header>
    }

    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    @if (!hideNavAndFooter)
    {
        <!-- Footer كامل -->
        <footer class="custom-footer">
            <div class="footer-container">
            <div class="footer-left">
                <h2 class="footer-heading" lang="ar">من وإلى شباب الوطن العربي</h2>
                <img src="/images/footerText.png" alt="footer text" class="footer-heading-img" />
                <div class="social-icons">
                        <a href="mailto:suppforaskhadra@gmail.com">
                            <iconify-icon icon="ic:round-email" width="34" height="34"></iconify-icon>
                        </a>
                        <a href="https://www.linkedin.com/company/foraskhadra/"><iconify-icon icon="mage:linkedin" width="34" height="34"></iconify-icon></a>
                    <a href="https://www.facebook.com/profile.php?id=61559156656756"><iconify-icon icon="mage:facebook-square" width="34" height="34"></iconify-icon></a>
                    <a href="https://www.instagram.com/foras_khadra/"><iconify-icon icon="basil:instagram-solid" width="34" height="34"></iconify-icon></a>
                </div>
                
            </div>
            <div class="footer-links">
                <div class="footer-column">
                    <h4>تصفح الفرص</h4>
                    <ul>
                            <li><a href="~/Home/AllOpportunities">@Localizer["AllOpportunities"]</a></li>
                            <li><a href="~/Home/AllOpportunities?type=Competitions">@Localizer["Competitions"]</a></li>
                            <li><a href="~/Home/AllOpportunities?type=Conferences">@Localizer["Conferences"]</a></li>
                            <li><a href="~/Home/AllOpportunities?type=Volunteering">@Localizer["VolunteeringOpportunities"]</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <ul>
                            <li><a href="~/Home/AllOpportunities?type=Jobs">@Localizer["Jobs"]</a></li>
                            <li><a href="~/Home/AllOpportunities?type=Scholarships">@Localizer["Scholarships"]</a></li>
                            <li><a href="~/Home/AllOpportunities?type=Fellowships">@Localizer["Fellowships"]</a></li>
                            <li><a href="~/Home/AllOpportunities?type=Internships">@Localizer["Internships"]</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>روابط إضافية</h4>
                    <ul>
                            <li><a href="~/Home/Articles">@Localizer["Articles"]</a></li>
                            <li><a href="~/Home/AboutUs">@Localizer["AboutUs"]</a></li>
                            <li><a href="~/contact/Index">@Localizer["ContactUs"]</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-logo">
                <img src="/images/logo.png" alt="شعار فرص خضراء" />
            </div>
        </div>
        <div class="footer-bottom">
                <p>@Localizer["All rights reserved © 2025"]</p>
        </div>
    </footer>
    }
    <!-- سكربتات -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>

    <script>
        function toggleOpportunities() { document.getElementById("opportunitiesDropdown").classList.toggle("show"); }
        function toggleLoginMenu() { document.getElementById("loginMenu").classList.toggle("show"); }
        function toggleRegisterMenu() { document.getElementById("registerMenu").classList.toggle("show"); }
        function toggleUserOrgMenu() { document.getElementById("userOrgMenu").classList.toggle("show"); }
        function toggleLangMenu() { document.getElementById("languageMenu").classList.toggle("show"); }

        document.addEventListener("click", function(e){
            if(!e.target.closest(".custom-dropdown") && !e.target.closest(".language-dropdown")) {
                ["loginMenu","registerMenu","userOrgMenu","opportunitiesDropdown"].forEach(id=>{
                    var el = document.getElementById(id);
                    if(el) el.classList.remove("show");
                });
                var langMenu = document.getElementById("languageMenu");
                if(langMenu) langMenu.classList.remove("show");
            }
        });
    </script>

    <script>
    const toggle = document.querySelector('.lang-toggle');
    const langList = document.querySelector('.lang-list');

    toggle.addEventListener('click', () => {
        langList.style.display = langList.style.display === 'block' ? 'none' : 'block';
    });

    // إخفاء القائمة لو ضغط المستخدم برة
    document.addEventListener('click', (e) => {
        if (!toggle.contains(e.target) && !langList.contains(e.target)) {
            langList.style.display = 'none';
        }
    });
</script>


    @RenderSection("Scripts", required: false)
</body>
</html>